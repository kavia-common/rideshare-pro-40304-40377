{"is_source_file": true, "format": "JavaScript", "description": "This is the main server source file for the rideshare backend application. It sets up an Express web server, defines REST API routes for authentication, ride management, and health checks, manages WebSocket connections for live ride updates, and includes a simulation loop to emulate driver movement and ride progression.", "external_files": ["./db/index.js"], "external_methods": ["createUser", "findUserByEmail", "findNearestDriver", "setDriverAvailability", "updateDriverPosition", "saveRide", "getRideById", "listRidesByUser", "updateRideStatus"], "published": ["app", "broadcastRide", "wss"], "classes": [], "methods": [{"name": "createToken(payload, expiresIn = '2h')", "description": "Creates a signed JWT token with configurable expiry for user authentication.", "scope": "", "scopeKind": ""}, {"name": "authMiddleware(req, res, next)", "description": "Middleware to validate JWT tokens and attach user info to the request object.", "scope": "", "scopeKind": ""}, {"name": "clampInt(val, def, min, max)", "description": "Utility to clamp query parameters like limit and offset within specified bounds.", "scope": "", "scopeKind": ""}, {"name": "estimatePrice(pickup, dropoff, driverDistanceKm = 0)", "description": "Calculates an estimated ride price based on pickup and dropoff locations and driver distance.", "scope": "", "scopeKind": ""}, {"name": "broadcastRide(rideId, payload)", "description": "Sends ride update messages to all WebSocket clients subscribed to a specific ride.", "scope": "", "scopeKind": ""}, {"name": "stepTowards(pos, target, stepKm = 0.2)", "description": "Computes a coordinate step towards a target position to simulate movement.", "scope": "", "scopeKind": ""}, {"name": "simulationTick()", "description": "Periodically updates driver positions and ride statuses for simulation purposes.", "scope": "", "scopeKind": ""}, {"name": "shutdown()", "description": "Handles graceful server shutdown on termination signals.", "scope": "", "scopeKind": ""}, {"name": "log(level, msg, meta)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["jwt.sign", "jwt.verify", "bcrypt.hash", "bcrypt.compare", "express.json", "cors", "ws.WebSocketServer", "app.use", "app.get", "app.post", "app.listen", "ws.ping", "ws.close", "wss.clients.forEach", "setInterval", "clearInterval", "process.on", "process.exit"], "search-terms": ["ride_booking_backend", "WebSocketServer", "simulationTick", "broadcastRide", "WS_PATH", "driver simulation", "ride statuses", "in-memory datastore"], "state": 2, "file_id": 29, "knowledge_revision": 64, "git_revision": "a498e4a592e25192dd5097c9d98f34e0645755b2", "ctags": [{"_type": "tag", "name": "FRONTEND_URL", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const FRONTEND_URL = process.env.FRONTEND_URL || 'http:\\/\\/localhost:3000';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "JWT_SECRET", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const JWT_SECRET = process.env.JWT_SECRET || 'dev-secret';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "LOG_LEVEL", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const LOG_LEVEL = process.env.LOG_LEVEL || 'info';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "PORT", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const PORT = parseInt(process.env.PORT || '4000', 10);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "SIM_TICK_MS", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const SIM_TICK_MS = 1500;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "WS_PATH", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const WS_PATH = process.env.WS_PATH || '\\/ws';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const app = express();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function authMiddleware(req, res, next) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, res, next)"}, {"_type": "tag", "name": "broadcastRide", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function broadcastRide(rideId, payload) {$/", "language": "JavaScript", "kind": "function", "signature": "(rideId, payload)"}, {"_type": "tag", "name": "clampInt", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function clampInt(val, def, min, max) {$/", "language": "JavaScript", "kind": "function", "signature": "(val, def, min, max)"}, {"_type": "tag", "name": "createToken", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function createToken(payload, expiresIn = '2h') {$/", "language": "JavaScript", "kind": "function", "signature": "(payload, expiresIn = '2h')"}, {"_type": "tag", "name": "estimatePrice", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function estimatePrice(pickup, dropoff, driverDistanceKm = 0) {$/", "language": "JavaScript", "kind": "function", "signature": "(pickup, dropoff, driverDistanceKm = 0)"}, {"_type": "tag", "name": "init", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^        const init = {$/", "language": "JavaScript", "kind": "class", "scope": "simulationTick", "scopeKind": "class"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^          lat: (ride.pickup?.lat ?? 37.7749) + (Math.random() - 0.5) * 0.01,$/", "language": "JavaScript", "kind": "property", "scope": "simulationTick.init", "scopeKind": "class"}, {"_type": "tag", "name": "lng", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^          lng: (ride.pickup?.lng ?? -122.4194) + (Math.random() - 0.5) * 0.01,$/", "language": "JavaScript", "kind": "property", "scope": "simulationTick.init", "scopeKind": "class"}, {"_type": "tag", "name": "log", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function log(level, msg, meta) {$/", "language": "JavaScript", "kind": "function", "signature": "(level, msg, meta)"}, {"_type": "tag", "name": "rideChannels", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const rideChannels = new Map();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "server", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const server = app.listen(PORT, () => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "shutdown", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function shutdown() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "simulationTick", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function simulationTick() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "stepTowards", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^function stepTowards(pos, target, stepKm = 0.2) {$/", "language": "JavaScript", "kind": "function", "signature": "(pos, target, stepKm = 0.2)"}, {"_type": "tag", "name": "wsPingInterval", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const wsPingInterval = setInterval(() => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "wss", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40304-40377/ride_booking_backend/src/server.js", "pattern": "/^const wss = new WebSocketServer({ server, path: WS_PATH });$/", "language": "JavaScript", "kind": "constant"}], "hash": "410aad59da7f266d6449b6de47f800f5", "format-version": 4, "code-base-name": "ride_booking_frontend", "filename": "ride_booking_backend/src/server.js", "fields": [{"name": "lat: (ride.pickup?.lat ?? 37.7749) + (Math.random() - 0.5) * 0.01,", "scope": "simulationTick.init", "scopeKind": "class", "description": "unavailable"}, {"name": "lng: (ride.pickup?.lng ?? -122.4194) + (Math.random() - 0.5) * 0.01,", "scope": "simulationTick.init", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"64": "a498e4a592e25192dd5097c9d98f34e0645755b2"}]}